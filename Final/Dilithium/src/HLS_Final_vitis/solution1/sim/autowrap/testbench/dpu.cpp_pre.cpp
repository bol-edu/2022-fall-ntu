# 1 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/dpu.cpp"
# 1 "<built-in>"
# 1 "<command-line>"
# 1 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/dpu.cpp"
# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/lib/gcc/x86_64-w64-mingw32/6.2.0/include/stdint.h" 1 3 4
# 10 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/lib/gcc/x86_64-w64-mingw32/6.2.0/include/stdint.h" 3 4
# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/stdint.h" 1 3 4
# 29 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/stdint.h" 3 4
# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/crtdefs.h" 1 3 4
# 11 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/crtdefs.h" 3 4
# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw.h" 1 3 4
# 13 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw.h" 3 4
# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw_mac.h" 1 3 4
# 89 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw_mac.h" 3 4
             
# 98 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw_mac.h" 3 4
             
# 14 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw.h" 2 3 4
# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw_secapi.h" 1 3 4
# 45 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw_secapi.h" 3 4

# 45 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw_secapi.h" 3 4
extern "C++" {
template <bool __test, typename __dsttype>
  struct __if_array;
template <typename __dsttype>
  struct __if_array <true, __dsttype> {
    typedef __dsttype __type;
};
}
# 15 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw.h" 2 3 4
# 276 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw.h" 3 4
# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/vadefs.h" 1 3 4
# 10 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/vadefs.h" 3 4
# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw.h" 1 3 4
# 566 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw.h" 3 4
# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/sdks/_mingw_directx.h" 1 3 4
# 567 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw.h" 2 3 4
# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/sdks/_mingw_ddk.h" 1 3 4
# 568 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw.h" 2 3 4
# 11 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/vadefs.h" 2 3 4




#pragma pack(push,_CRT_PACKING)



extern "C" {





  typedef __builtin_va_list __gnuc_va_list;






  typedef __gnuc_va_list va_list;
# 100 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/vadefs.h" 3 4
}



#pragma pack(pop)
# 277 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw.h" 2 3 4
# 535 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/_mingw.h" 3 4
extern "C" {




void __attribute__((__cdecl__)) __debugbreak(void);
extern __inline__ __attribute__((__always_inline__,__gnu_inline__)) void __attribute__((__cdecl__)) __debugbreak(void)
{
  __asm__ __volatile__("int {$}3":);
}




const char *__mingw_get_crt_info (void);


}
# 12 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/crtdefs.h" 2 3 4




#pragma pack(push,_CRT_PACKING)
# 36 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/crtdefs.h" 3 4
__extension__ typedef unsigned long long size_t;
# 46 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/crtdefs.h" 3 4
__extension__ typedef long long ssize_t;






typedef size_t rsize_t;
# 63 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/crtdefs.h" 3 4
__extension__ typedef long long intptr_t;
# 76 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/crtdefs.h" 3 4
__extension__ typedef unsigned long long uintptr_t;
# 89 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/crtdefs.h" 3 4
__extension__ typedef long long ptrdiff_t;
# 107 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/crtdefs.h" 3 4
typedef unsigned short wint_t;
typedef unsigned short wctype_t;





typedef int errno_t;




typedef long __time32_t;




__extension__ typedef long long __time64_t;
# 139 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/crtdefs.h" 3 4
typedef __time64_t time_t;
# 423 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/crtdefs.h" 3 4
struct threadlocaleinfostruct;
struct threadmbcinfostruct;
typedef struct threadlocaleinfostruct *pthreadlocinfo;
typedef struct threadmbcinfostruct *pthreadmbcinfo;
struct __lc_time_data;

typedef struct localeinfo_struct {
  pthreadlocinfo locinfo;
  pthreadmbcinfo mbcinfo;
} _locale_tstruct,*_locale_t;



typedef struct tagLC_ID {
  unsigned short wLanguage;
  unsigned short wCountry;
  unsigned short wCodePage;
} LC_ID,*LPLC_ID;




typedef struct threadlocaleinfostruct {
  int refcount;
  unsigned int lc_codepage;
  unsigned int lc_collate_cp;
  unsigned long lc_handle[6];
  LC_ID lc_id[6];
  struct {
    char *locale;
    wchar_t *wlocale;
    int *refcount;
    int *wrefcount;
  } lc_category[6];
  int lc_clike;
  int mb_cur_max;
  int *lconv_intl_refcount;
  int *lconv_num_refcount;
  int *lconv_mon_refcount;
  struct lconv *lconv;
  int *ctype1_refcount;
  unsigned short *ctype1;
  const unsigned short *pctype;
  const unsigned char *pclmap;
  const unsigned char *pcumap;
  struct __lc_time_data *lc_time_curr;
} threadlocinfo;







#pragma pack(pop)
# 30 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/stdint.h" 2 3 4



# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/lib/gcc/x86_64-w64-mingw32/6.2.0/include/stddef.h" 1 3 4

# 1 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/stddef.h" 1 3 4
# 14 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/stddef.h" 3 4
extern "C" {




  __attribute__ ((__dllimport__)) extern int *__attribute__((__cdecl__)) _errno(void);

  errno_t __attribute__((__cdecl__)) _set_errno(int _Value);
  errno_t __attribute__((__cdecl__)) _get_errno(int *_Value);


  __attribute__ ((__dllimport__)) extern unsigned long __attribute__((__cdecl__)) __threadid(void);

  __attribute__ ((__dllimport__)) extern uintptr_t __attribute__((__cdecl__)) __threadhandle(void);


}
# 3 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/lib/gcc/x86_64-w64-mingw32/6.2.0/include/stddef.h" 2 3 4
# 428 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/lib/gcc/x86_64-w64-mingw32/6.2.0/include/stddef.h" 3 4
typedef struct {
  long long __max_align_ll __attribute__((__aligned__(__alignof__(long long))));
  long double __max_align_ld __attribute__((__aligned__(__alignof__(long double))));
} max_align_t;






  typedef decltype(nullptr) nullptr_t;
# 34 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/x86_64-w64-mingw32/include/stdint.h" 2 3 4


typedef signed char int8_t;
typedef unsigned char uint8_t;
typedef short int16_t;
typedef unsigned short uint16_t;
typedef int int32_t;
typedef unsigned uint32_t;
__extension__ typedef long long int64_t;
__extension__ typedef unsigned long long uint64_t;


typedef signed char int_least8_t;
typedef unsigned char uint_least8_t;
typedef short int_least16_t;
typedef unsigned short uint_least16_t;
typedef int int_least32_t;
typedef unsigned uint_least32_t;
__extension__ typedef long long int_least64_t;
__extension__ typedef unsigned long long uint_least64_t;





typedef signed char int_fast8_t;
typedef unsigned char uint_fast8_t;
typedef short int_fast16_t;
typedef unsigned short uint_fast16_t;
typedef int int_fast32_t;
typedef unsigned int uint_fast32_t;
__extension__ typedef long long int_fast64_t;
__extension__ typedef unsigned long long uint_fast64_t;


__extension__ typedef long long intmax_t;
__extension__ typedef unsigned long long uintmax_t;
# 11 "Z:/Xilinx/Vitis_HLS/2022.1/tps/win64/msys64/mingw64/lib/gcc/x86_64-w64-mingw32/6.2.0/include/stdint.h" 2 3 4
# 2 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/dpu.cpp" 2
# 1 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/clean/params.h" 1



# 1 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/clean/config.h" 1
# 5 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/clean/params.h" 2
# 3 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/dpu.cpp" 2
# 1 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/dpu.h" 1
# 91 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/dpu.h"

# 91 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/dpu.h"
class DPU
{
private:
public:
    int32_t pMem [5*6 + 3*5 + 5*6 + 1 + 6*10 + 22][256];
    int32_t p1[256], p2[256], p3[256], p4[256];
    int32_t p5[256];
    int norm_err;
    int sig_err;
    int hn;
    DPU();
    void read_p1(uint8_t addr);
    void read_p2(uint8_t addr);
    void read_p5(uint8_t addr);
    void read_ntt(uint8_t addr);
    void read_intt(uint8_t addr);
    void write_p3(uint8_t addr);
    void write_p4(uint8_t addr);
    void write_p5(uint8_t addr);
    void read_Mem(int32_t* a, uint8_t addr);
    void write_Mem(int32_t* a, uint8_t addr);
    void dpu_func(const uint8_t addr1, const uint8_t addr2, const uint8_t addr3, uint8_t type, uint8_t arg, uint8_t itr);
    void dpu_pack(const uint8_t addr, uint8_t rb[1024], uint8_t pb[1024], int ptrs, uint8_t type, const int itr);
    void dpu_unit(uint8_t type);
};
# 4 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/dpu.cpp" 2
static const int32_t zetas[256] = {
     0, 25847, -2608894, -518909, 237124, -777960, -876248, 466468,
  1826347, 2353451, -359251, -2091905, 3119733, -2884855, 3111497, 2680103,
  2725464, 1024112, -1079900, 3585928, -549488, -1119584, 2619752, -2108549,
 -2118186, -3859737, -1399561, -3277672, 1757237, -19422, 4010497, 280005,
  2706023, 95776, 3077325, 3530437, -1661693, -3592148, -2537516, 3915439,
 -3861115, -3043716, 3574422, -2867647, 3539968, -300467, 2348700, -539299,
 -1699267, -1643818, 3505694, -3821735, 3507263, -2140649, -1600420, 3699596,
   811944, 531354, 954230, 3881043, 3900724, -2556880, 2071892, -2797779,
 -3930395, -1528703, -3677745, -3041255, -1452451, 3475950, 2176455, -1585221,
 -1257611, 1939314, -4083598, -1000202, -3190144, -3157330, -3632928, 126922,
  3412210, -983419, 2147896, 2715295, -2967645, -3693493, -411027, -2477047,
  -671102, -1228525, -22981, -1308169, -381987, 1349076, 1852771, -1430430,
 -3343383, 264944, 508951, 3097992, 44288, -1100098, 904516, 3958618,
 -3724342, -8578, 1653064, -3249728, 2389356, -210977, 759969, -1316856,
   189548, -3553272, 3159746, -1851402, -2409325, -177440, 1315589, 1341330,
  1285669, -1584928, -812732, -1439742, -3019102, -3881060, -3628969, 3839961,
  2091667, 3407706, 2316500, 3817976, -3342478, 2244091, -2446433, -3562462,
   266997, 2434439, -1235728, 3513181, -3520352, -3759364, -1197226, -3193378,
   900702, 1859098, 909542, 819034, 495491, -1613174, -43260, -522500,
  -655327, -3122442, 2031748, 3207046, -3556995, -525098, -768622, -3595838,
   342297, 286988, -2437823, 4108315, 3437287, -3342277, 1735879, 203044,
  2842341, 2691481, -2590150, 1265009, 4055324, 1247620, 2486353, 1595974,
 -3767016, 1250494, 2635921, -3548272, -2994039, 1869119, 1903435, -1050970,
 -1333058, 1237275, -3318210, -1430225, -451100, 1312455, 3306115, -1962642,
 -1279661, 1917081, -2546312, -1374803, 1500165, 777191, 2235880, 3406031,
  -542412, -2831860, -1671176, -1846953, -2584293, -3724270, 594136, -3776993,
 -2013608, 2432395, 2454455, -164721, 1957272, 3369112, 185531, -1207385,
 -3183426, 162844, 1616392, 3014001, 810149, 1652634, -3694233, -1799107,
 -3038916, 3523897, 3866901, 269760, 2213111, -975884, 1717735, 472078,
  -426683, 1723600, -1803090, 1910376, -1667432, -1104333, -260646, -3833893,
 -2939036, -2235985, -420899, -2286327, 183443, -976891, 1612842, -3545687,
  -554416, 3919660, -48306, -1362209, 3937738, 1400424, -846154, 1976782
};

DPU::DPU(){
 for(int i=0;i<256;i++) pMem[5*6 + 3*5 + 5*6 + 1 + 6*10][i] = 8380417;
 for(int i=0;i<256;i++) pMem[5*6 + 3*5 + 5*6 + 1 + 6*10 + 1][i] = 58728449;
 for(int i=0;i<8;i++){
  for(int j=0;j<256;j++){
   if(j<128) pMem[5*6 + 3*5 + 5*6 + 1 + 6*10 + 2 +i][j] = -4186625;
   else pMem[5*6 + 3*5 + 5*6 + 1 + 6*10 + 2 +i][j] = zetas[(1<<i) + ((j-128) % (1<<i))];
  }
 }
 for(int i=7;i>=0;i--){
  for(int j=0;j<256;j++){
   if(j<128) pMem[5*6 + 3*5 + 5*6 + 1 + 6*10 + 10 +(7-i)][j] = -4186625;
   else pMem[5*6 + 3*5 + 5*6 + 1 + 6*10 + 10 +(7-i)][j] = -zetas[(1<<(i+1)) - 1 - ((j-128) % (1<<i))];
  }
 }
 for(int i=0;i<256;i++) pMem[5*6 + 3*5 + 5*6 + 1 + 6*10 + 18][i] = 41978;
 for(int i=0;i<256;i++) pMem[5*6 + 3*5 + 5*6 + 1 + 6*10 + 19][i] = 1025;
 for(int i=0;i<256;i++) pMem[5*6 + 3*5 + 5*6 + 1 + 6*10 + 20][i] = 2*((8380417 -1)/32);
}
void DPU::read_p1(uint8_t addr){
 for(int i=0;i<256;i++) {
#pragma HLS unroll factor=256
  p1[i] = pMem[addr][i];
 }
}

void DPU::read_p2(uint8_t addr){
 for(int i=0;i<256;i++){
#pragma HLS unroll factor=256
  p2[i] = pMem[addr][i];
 }
}

void DPU::read_p5(uint8_t addr){
 for(int i=0;i<256;i++) p5[i] = pMem[addr][i];
}

void DPU::write_p3(uint8_t addr){
 for(int i=0;i<256;i++){
#pragma HLS unroll factor=256
  pMem[addr][i] = p3[i];
 }
}

void DPU::write_p4(uint8_t addr){
 for(int i=0;i<256;i++){
#pragma HLS unroll factor=256
  pMem[addr][i] = p4[i];
 }
}

void DPU::write_p5(uint8_t addr){
 for(int i=0;i<256;i++) pMem[addr][i] = p5[i];
}

void DPU::write_Mem(int32_t* a, uint8_t addr){
 for(int i=0;i<256;i++) pMem[addr][i] = a[i];
}
void DPU::read_Mem(int32_t* a, uint8_t addr){
 for(int i=0;i<256;i++) a[i] = pMem[addr][i];
}

void DPU::read_ntt(uint8_t addr){
 for(int i=0;i<256;i++){
#pragma HLS unroll factor=256
  int32_t tmp = pMem[addr][i];
  if(i<128){
   p1[2*i] = tmp;
   p1[2*i+1] = tmp;
  }
  else{
   p2[2*(i-128)] = tmp;
   p2[2*(i-128)+1] = tmp;
  }
 }
}

void DPU::read_intt(uint8_t addr){
 for(int i=0;i<256;i++){
#pragma HLS unroll factor=256
  int32_t tmp = pMem[addr][i];
  if(i%2==0){
   p1[(i>>1)] = tmp;
   p1[(i>>1)+128] = tmp;
  }
  else{
   p2[(i>>1)] = tmp;
   p2[(i>>1)+128] = tmp;
  }
 }
}

void DPU::dpu_func(const uint8_t addr1, const uint8_t addr2, const uint8_t addr3, uint8_t type, uint8_t arg, uint8_t itr){
#pragma HLS ALLOCATION function instances=dpu_unit limit=1
#pragma HLS ALLOCATION function instances=read_p1 limit=1
#pragma HLS ALLOCATION function instances=read_p2 limit=1
#pragma HLS ALLOCATION function instances=write_p3 limit=1
#pragma HLS ALLOCATION function instances=write_p4 limit=1
 switch(type){
  case 0:
FUNC_ADD_LOOP1:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
    read_p1(addr1+i);
    read_p2(addr2+i);
    dpu_unit(0);
    write_p3(addr3+i);
   }
   break;

  case 1:
FUNC_SUB_LOOP1:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
    read_p1(addr1+i);
    read_p2(addr2+i);
    dpu_unit(1);
    write_p3(addr3+i);
   }
   break;

  case 2:

FUNC_RD_LOOP1:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
    read_p1(addr1+i);
    dpu_unit(3);
    write_p3(5*6 + 3*5 + 5*6 + 1 +i);
   }


   read_p2(5*6 + 3*5 + 5*6 + 1 + 6*10);
FUNC_RD_LOOP2:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
    read_p1(5*6 + 3*5 + 5*6 + 1 +i);
    dpu_unit(2);
    write_p3(5*6 + 3*5 + 5*6 + 1 +i);
   }


FUNC_RD_LOOP3:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
    read_p1(addr1+i);
    read_p2(5*6 + 3*5 + 5*6 + 1 +i);
    dpu_unit(1);
    write_p3(addr1+i);
   }
   break;

  case 3:

FUNC_MONTMUL_LOOP1:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
    read_p1(addr1);
    read_p2(addr2+i);
    dpu_unit(2);
    write_p3(5*6 + 3*5 + 5*6 + 1 +i);
    write_p4(5*6 + 3*5 + 5*6 + 1 +i+6);
   }


   read_p2(5*6 + 3*5 + 5*6 + 1 + 6*10 + 1);
FUNC_MONTMUL_LOOP2:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
    read_p1(5*6 + 3*5 + 5*6 + 1 +i);
    dpu_unit(2);
    write_p3(5*6 + 3*5 + 5*6 + 1 +i);
   }


   read_p2(5*6 + 3*5 + 5*6 + 1 + 6*10);
FUNC_MONTMUL_LOOP3:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
    read_p1(5*6 + 3*5 + 5*6 + 1 +i);
    dpu_unit(2);
    write_p4(5*6 + 3*5 + 5*6 + 1 +i);
   }


FUNC_MONTMUL_LOOP4:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
    read_p1(5*6 + 3*5 + 5*6 + 1 +i+6);
    read_p2(5*6 + 3*5 + 5*6 + 1 +i);
    dpu_unit(1);
    write_p3(addr3+i);
   }
   break;

  case 4:

FUNC_MATMUL_LOOP0:for(int k=0;k<6;k++){
FUNC_MATMUL_LOOP1:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(addr1+5*k+i);
     read_p2(addr2+i);
     dpu_unit(2);
     write_p3(5*6 + 3*5 + 5*6 + 1 +i);
     write_p4(5*6 + 3*5 + 5*6 + 1 +i+6);
    }


    read_p2(5*6 + 3*5 + 5*6 + 1 + 6*10 + 1);
FUNC_MATMUL_LOOP2:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(5*6 + 3*5 + 5*6 + 1 +i);
     dpu_unit(2);
     write_p3(5*6 + 3*5 + 5*6 + 1 +i);
    }


    read_p2(5*6 + 3*5 + 5*6 + 1 + 6*10);
FUNC_MATMUL_LOOP3:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(5*6 + 3*5 + 5*6 + 1 +i);
     dpu_unit(2);
     write_p4(5*6 + 3*5 + 5*6 + 1 +i);
    }


FUNC_MATMUL_LOOP4:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(5*6 + 3*5 + 5*6 + 1 +i+6);
     read_p2(5*6 + 3*5 + 5*6 + 1 +i);
     dpu_unit(1);
     write_p3(5*6 + 3*5 + 5*6 + 1 +i);
    }


FUNC_MATMUL_LOOP5:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(5*6 + 3*5 + 5*6 + 1 +i);
     read_p2(addr3+k);
     if (i==0) dpu_unit(5);
     else dpu_unit(0);
     write_p3(addr3+k);
    }
   }
   break;

  case 5:
FUNC_CADDQ_LOOP1:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
    read_p1(addr1+i);
    dpu_unit(4);
    write_p3(addr1+i);
   }
   break;

  case 6:
FUNC_POW2ROUND_LOOP1:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
    read_p1(addr1+i);
    dpu_unit(6);
    write_p3(addr2+i);
    write_p4(addr3+i);
   }
   break;
  case 7:

FUNC_NTT_LOOP0:for(int k=0;k<8;k++){
    read_p2(5*6 + 3*5 + 5*6 + 1 + 6*10 + 2 +k);
FUNC_NTT_LOOP1:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(addr1+i);
     dpu_unit(2);
     write_p3(5*6 + 3*5 + 5*6 + 1 +i);
     write_p4(5*6 + 3*5 + 5*6 + 1 +i+6);
    }


    read_p2(5*6 + 3*5 + 5*6 + 1 + 6*10 + 1);
FUNC_NTT_LOOP2:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(5*6 + 3*5 + 5*6 + 1 +i);
     dpu_unit(2);
     write_p3(5*6 + 3*5 + 5*6 + 1 +i);
    }


    read_p2(5*6 + 3*5 + 5*6 + 1 + 6*10);
FUNC_NTT_LOOP3:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(5*6 + 3*5 + 5*6 + 1 +i);
     dpu_unit(2);
     write_p4(5*6 + 3*5 + 5*6 + 1 +i);
    }


FUNC_NTT_LOOP4:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(5*6 + 3*5 + 5*6 + 1 +i+6);
     read_p2(5*6 + 3*5 + 5*6 + 1 +i);
     dpu_unit(1);
     write_p3(addr1+i);
    }


FUNC_NTT_LOOP5:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_ntt(addr1+i);
     dpu_unit(7);
     write_p3(addr1+i);
    }
   }
   break;
  case 8:

FUNC_INTT_LOOP0:for(int k=0;k<8;k++){

FUNC_INTT_LOOP1:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_intt(addr1+i);
     dpu_unit(8);
     write_p3(addr1+i);
    }

    read_p2(5*6 + 3*5 + 5*6 + 1 + 6*10 + 10 +k);
FUNC_INTT_LOOP2:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(addr1+i);
     dpu_unit(2);
     write_p3(5*6 + 3*5 + 5*6 + 1 +i);
     write_p4(5*6 + 3*5 + 5*6 + 1 +i+6);
    }


    read_p2(5*6 + 3*5 + 5*6 + 1 + 6*10 + 1);
FUNC_INTT_LOOP3:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(5*6 + 3*5 + 5*6 + 1 +i);
     dpu_unit(2);
     write_p3(5*6 + 3*5 + 5*6 + 1 +i);
    }


    read_p2(5*6 + 3*5 + 5*6 + 1 + 6*10);
FUNC_INTT_LOOP4:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(5*6 + 3*5 + 5*6 + 1 +i);
     dpu_unit(2);
     write_p4(5*6 + 3*5 + 5*6 + 1 +i);
    }


FUNC_INTT_LOOP5:for(int i=0;i<itr;i++){
#pragma HLS DEPENDENCE dependent=false type=inter variable=pMem
     read_p1(5*6 + 3*5 + 5*6 + 1 +i+6);
     read_p2(5*6 + 3*5 + 5*6 + 1 +i);
     dpu_unit(1);
     write_p3(addr1+i);
    }
   }
   break;
# 528 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/dpu.cpp"
 }
}

void DPU::dpu_unit(uint8_t type){
DPU_UNIT_LOOP:for(int i=0;i<256;i++) {
#pragma HLS unroll factor=256
  int64_t tmp;
  switch(type){
   case 0:
    p3[i] = p1[i] + p2[i];
    break;
   case 1:
    p3[i] = p1[i] - p2[i];
    break;
   case 2:
    tmp = (int64_t)p1[i]*p2[i];
    p3[i] = tmp;
    p4[i] = (int32_t)(tmp>>32);
    break;
   case 3:
    p3[i] = (p1[i] + (1 << 22)) >> 23;
    break;
   case 4:
    p3[i] = p1[i] + ((p1[i] >> 31) & 8380417);
    break;
   case 5:
    p3[i] = p1[i];
    break;
   case 6:
    p3[i] = (p1[i] + (1 << (13 -1)) - 1) >> 13;
    p4[i] = p1[i] - (p3[i] << 13);
    break;
   case 7:
    if(i%2==0) p3[i] = p1[i] + p2[i];
    else p3[i] = p1[i] - p2[i];
    break;
   case 8:
    if(i<128) p3[i] = p1[i] + p2[i];
    else p3[i] = p1[i] - p2[i];
    break;
# 594 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/dpu.cpp"
  }
 }
}

void DPU::dpu_pack(const uint8_t addr, uint8_t rb[1024], uint8_t pb[1024], int ptrs, uint8_t type, const int itr){
 static int ptr;
 ptr = ptrs;
 switch(type){
  case 0:
   for(int j=0; j<6; j++){
    read_p5(addr+j);
    for(int i=0; i < 256/4; ++i) {
     pb[ptr+0] = (p5[4*i+0] >> 0);
     pb[ptr+1] = (p5[4*i+0] >> 8) | (p5[4*i+1] << 2);
     pb[ptr+2] = (p5[4*i+1] >> 6) | (p5[4*i+2] << 4);
     pb[ptr+3] = (p5[4*i+2] >> 4) | (p5[4*i+3] << 6);
     pb[ptr+4] = (p5[4*i+3] >> 2);
     ptr += 5;
    }
   }
   break;
  case 1:
   for(int j=0; j<6; j++){
    for(int i = 0; i < 256/4; ++i) {
     p5[4*i+0] = (((uint32_t)pb[ptr+0] >> 0) | ((uint32_t)pb[ptr+1] << 8)) & 0x3FF;
     p5[4*i+1] = (((uint32_t)pb[ptr+1] >> 2) | ((uint32_t)pb[ptr+2] << 6)) & 0x3FF;
     p5[4*i+2] = (((uint32_t)pb[ptr+2] >> 4) | ((uint32_t)pb[ptr+3] << 4)) & 0x3FF;
     p5[4*i+3] = (((uint32_t)pb[ptr+3] >> 6) | ((uint32_t)pb[ptr+4] << 2)) & 0x3FF;
     ptr += 5;
    }
    write_p5(addr+j);
   }
   break;
  case 2:
   for(int j=0; j<6; j++){
    read_p5(addr+j);
    for(int i = 0; i < 256/8; ++i) {
     uint32_t t[8];
     t[0] = (1 << (13 -1)) - p5[8*i+0];
     t[1] = (1 << (13 -1)) - p5[8*i+1];
     t[2] = (1 << (13 -1)) - p5[8*i+2];
     t[3] = (1 << (13 -1)) - p5[8*i+3];
     t[4] = (1 << (13 -1)) - p5[8*i+4];
     t[5] = (1 << (13 -1)) - p5[8*i+5];
     t[6] = (1 << (13 -1)) - p5[8*i+6];
     t[7] = (1 << (13 -1)) - p5[8*i+7];
     pb[ptr+ 0] = t[0];
     pb[ptr+ 1] = t[0] >> 8;
     pb[ptr+ 1] |= t[1] << 5;
     pb[ptr+ 2] = t[1] >> 3;
     pb[ptr+ 3] = t[1] >> 11;
     pb[ptr+ 3] |= t[2] << 2;
     pb[ptr+ 4] = t[2] >> 6;
     pb[ptr+ 4] |= t[3] << 7;
     pb[ptr+ 5] = t[3] >> 1;
     pb[ptr+ 6] = t[3] >> 9;
     pb[ptr+ 6] |= t[4] << 4;
     pb[ptr+ 7] = t[4] >> 4;
     pb[ptr+ 8] = t[4] >> 12;
     pb[ptr+ 8] |= t[5] << 1;
     pb[ptr+ 9] = t[5] >> 7;
     pb[ptr+ 9] |= t[6] << 6;
     pb[ptr+10] = t[6] >> 2;
     pb[ptr+11] = t[6] >> 10;
     pb[ptr+11] |= t[7] << 3;
     pb[ptr+12] = t[7] >> 5;
     ptr += 13;
    }
   }
   break;
  case 3:
   for(int j=0; j<6; j++){
    for(int i = 0; i < 256/8; ++i) {
     uint32_t t[8];
        t[0] = (((uint32_t)pb[ptr+ 0] ) | ((uint32_t)pb[ptr+ 1] << 8)) & 0x1FFF;
        t[1] = (((uint32_t)pb[ptr+ 1] >> 5) | ((uint32_t)pb[ptr+ 2] << 3) | ((uint32_t)pb[ptr+ 3] << 11)) & 0x1FFF;
        t[2] = (((uint32_t)pb[ptr+ 3] >> 2) | ((uint32_t)pb[ptr+ 4] << 6)) & 0x1FFF;
        t[3] = (((uint32_t)pb[ptr+ 4] >> 7) | ((uint32_t)pb[ptr+ 5] << 1) | ((uint32_t)pb[ptr+ 6] << 9)) & 0x1FFF;
        t[4] = (((uint32_t)pb[ptr+ 7] >> 4) | ((uint32_t)pb[ptr+ 7] << 4) | ((uint32_t)pb[ptr+ 8] << 12)) & 0x1FFF;
        t[5] = (((uint32_t)pb[ptr+ 8] >> 1) | ((uint32_t)pb[ptr+ 9] << 7)) & 0x1FFF;
        t[6] = (((uint32_t)pb[ptr+ 9] >> 6) | ((uint32_t)pb[ptr+10] << 2) | ((uint32_t)pb[ptr+11] << 10)) & 0x1FFF;
        t[7] = (((uint32_t)pb[ptr+ 11] >> 3) | ((uint32_t)pb[ptr+12] << 5)) & 0x1FFF;

        p5[8*i+0] = (1 << (13 -1)) - t[0];
        p5[8*i+1] = (1 << (13 -1)) - t[1];
        p5[8*i+2] = (1 << (13 -1)) - t[2];
        p5[8*i+3] = (1 << (13 -1)) - t[3];
        p5[8*i+4] = (1 << (13 -1)) - t[4];
        p5[8*i+5] = (1 << (13 -1)) - t[5];
        p5[8*i+6] = (1 << (13 -1)) - t[6];
        p5[8*i+7] = (1 << (13 -1)) - t[7];
        ptr += 13;
    }
    write_p5(addr+j);
   }
   break;
  case 4:
   for(int j=0; j<5; j++){
    read_p5(addr+j);
    for(int i = 0; i < 256/2; ++i) {
     uint32_t t[2];
     t[0] = (1 << 19) - p5[2*i+0];
     t[1] = (1 << 19) - p5[2*i+1];
     pb[ptr+0] = t[0];
     pb[ptr+1] = t[0] >> 8;
     pb[ptr+2] = t[0] >> 16;
     pb[ptr+2] |= t[1] << 4;
     pb[ptr+3] = t[1] >> 4;
     pb[ptr+4] = t[1] >> 12;
     ptr += 5;
    }
   }
   break;
  case 5:
   for(int j=0; j<5; j++){
    for(int i = 0; i < 256/2; ++i) {
     uint32_t t[2];
        t[0] = (((uint32_t)pb[ptr+0] ) | ((uint32_t)pb[ptr+1] << 8) | ((uint32_t)pb[ptr+2] << 16)) & 0xFFFFF;
        t[1] = (((uint32_t)pb[ptr+2] >> 4) | ((uint32_t)pb[ptr+3] << 4) | ((uint32_t)pb[ptr+4] << 12)) & 0xFFFFF;
        p5[2*i+0] = (1 << 19) - t[0];
        p5[2*i+1] = (1 << 19) - t[1];
        ptr += 5;
    }
    write_p5(addr+j);
   }
   break;
  case 6:
   for(int j=0; j<itr; j++){
    read_p5(addr+j);
    for(int i = 0; i < 256/2; ++i) {
     uint32_t t[2];
     t[0] = 4 - p5[2*i+0];
     t[1] = 4 - p5[2*i+1];
     pb[ptr] = t[0] | (t[1] << 4);
     ptr += 1;
    }
   }
   break;
  case 7:
   for(int j=0; j<itr; j++){
    for(int i = 0; i < 256/2; ++i) {
     uint32_t t[2];
     t[0] = pb[ptr] & 0x0F;
     t[1] = pb[ptr] >> 4;
     p5[2*i+0] = 4 - t[0];
     p5[2*i+1] = 4 - t[1];
     ptr += 1;
    }
    write_p5(addr+j);
   }
   break;
  case 8:
   for(int j=0; j<6; j++){
    read_p5(addr+j);
      for(int i = 0; i < 256/2; ++i){
       pb[ptr] = p5[2*i+0] | (p5[2*i+1] << 4);
       ptr += 1;
      }
   }
   break;
# 769 "C:/Users/user/Desktop/HLS/HLS_Final_vitis_src/dpu.cpp"
  case 11:
   norm_err = 0;
   for(int j=0; j<itr; j++){
    read_p5(addr+j);
    for(int i = 0; i < 256; ++i){
     if((p5[i] >= ptrs)||(p5[i] <= -ptrs)){
      norm_err = 1;
      break;
     }
    }
    if(norm_err==1) break;
   }
   break;

  case 12:{
   unsigned int k = 0;
   for(int unsigned i = 0; i < 55 + 6; ++i) {pb[i] = 0;}
   for(int unsigned i = 0; i < 6; ++i){
    read_p5(addr+i);
    for(unsigned int j = 0; j < 256; ++j) if(p5[j] != 0) pb[k++] = j;
    pb[55 + i] = k;
   }
   break;}

  case 13:{
   unsigned int k = 0;
   uint8_t* pb2 = pb + ptr;
   sig_err = 0;
   for(int unsigned i = 0; i < 6; ++i){
    for(unsigned int j = 0; j < 256; ++j) p5[j] = 0;
    if(pb2[55 + i] < k || pb2[55 + i] > 55){
     sig_err = 1;
     break;
    }
    for(unsigned int j = k; j < pb2[55 + i]; ++j){
     if(j > k && pb2[j] <= pb2[j-1]){
      sig_err = 1;
      break;
     }
     else p5[pb2[j]] = 1;
    }
    if(sig_err==1) break;
    write_p5(addr+i);
    k = pb2[55 + i];
   }
   if(sig_err==0){
    for(unsigned int j = k; j < 55; ++j){
     if(pb2[j]){
      sig_err = 1;
      break;
     }
    }
   }
   break;}

  case 14:{
   hn = 0;
   for(int j=0; j<6; j++){
    read_p5(addr+j);
      for(int i = 0; i < 256; ++i){
       if(p5[i]==1) hn += 1;
      }
   }

   break;}
 }
}
